<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Assess the calibration of a multistate model — calib_msm • calibmsm</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Assess the calibration of a multistate model — calib_msm"><meta name="description" content="Calculates the underlying data for calibration plots of the predicted transition
probabilities from a multistate model using three methods.
BLR-IPCW: Binary logistic regression with inverse probability of censoring weights.
MLR-IPCW: Multinomial logistic regression with inverse probability of censoring
weights, based on the nominal calibration  framework of van Hoorde et al. (2014, 2015)
Pseudo-values: Pseudo-values estimated using the Aalen-Johansen estimator (Aalen OO, Johansen S, 1978).

"><meta property="og:description" content="Calculates the underlying data for calibration plots of the predicted transition
probabilities from a multistate model using three methods.
BLR-IPCW: Binary logistic regression with inverse probability of censoring weights.
MLR-IPCW: Multinomial logistic regression with inverse probability of censoring
weights, based on the nominal calibration  framework of van Hoorde et al. (2014, 2015)
Pseudo-values: Pseudo-values estimated using the Aalen-Johansen estimator (Aalen OO, Johansen S, 1978).

"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">calibmsm</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.1.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/BLR-IPCW-manual-bootstrap.html">BLR-IPCW-manual-bootstrap</a></li>
    <li><a class="dropdown-item" href="../articles/Calibration-curves-estimated-with-loess-smoothers.html">Calibration-curves-estimated-with-loess-smoothers</a></li>
    <li><a class="dropdown-item" href="../articles/Comparison-in-competing-risks-setting.html">Comparison-in-competing-risks-setting</a></li>
    <li><a class="dropdown-item" href="../articles/Directory-of-vignettes.html">A catalogue of links and descriptions for the vignettes/articles</a></li>
    <li><a class="dropdown-item" href="../articles/Overview.html">Overview</a></li>
    <li><a class="dropdown-item" href="../articles/Sensitivity-analysis-for-IPCWs.html">Sensitivity-analyses-for-IPCWs</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Assess the calibration of a multistate model</h1>

      <div class="d-none name"><code>calib_msm.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Calculates the underlying data for calibration plots of the predicted transition
probabilities from a multistate model using three methods.</p><ol><li><p>BLR-IPCW: Binary logistic regression with inverse probability of censoring weights.</p></li>
<li><p>MLR-IPCW: Multinomial logistic regression with inverse probability of censoring
weights, based on the nominal calibration  framework of van Hoorde et al. (2014, 2015)</p></li>
<li><p>Pseudo-values: Pseudo-values estimated using the Aalen-Johansen estimator (Aalen OO, Johansen S, 1978).</p></li>
</ol></div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">calib_msm</span><span class="op">(</span></span>
<span>  <span class="va">data_ms</span>,</span>
<span>  <span class="va">data_raw</span>,</span>
<span>  <span class="va">j</span>,</span>
<span>  <span class="va">s</span>,</span>
<span>  <span class="va">t</span>,</span>
<span>  <span class="va">tp_pred</span>,</span>
<span>  tp_pred_plot <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  calib_type <span class="op">=</span> <span class="st">"blr"</span>,</span>
<span>  curve_type <span class="op">=</span> <span class="st">"rcs"</span>,</span>
<span>  rcs_nk <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  loess_span <span class="op">=</span> <span class="fl">0.75</span>,</span>
<span>  loess_degree <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  loess_surface <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"interpolate"</span>, <span class="st">"direct"</span><span class="op">)</span>,</span>
<span>  loess_statistics <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"approximate"</span>, <span class="st">"exact"</span>, <span class="st">"none"</span><span class="op">)</span>,</span>
<span>  loess_trace_hat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"exact"</span>, <span class="st">"approximate"</span><span class="op">)</span>,</span>
<span>  loess_cell <span class="op">=</span> <span class="fl">0.2</span>,</span>
<span>  loess_iterations <span class="op">=</span> <span class="fl">4</span>,</span>
<span>  loess_iterTrace <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  mlr_smoother_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"sm.ps"</span>, <span class="st">"sm.os"</span>, <span class="st">"s"</span><span class="op">)</span>,</span>
<span>  mlr_ps_int <span class="op">=</span> <span class="fl">4</span>,</span>
<span>  mlr_degree <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  mlr_s_df <span class="op">=</span> <span class="fl">4</span>,</span>
<span>  mlr_niknots <span class="op">=</span> <span class="fl">4</span>,</span>
<span>  weights <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  w_function <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  w_covs <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  w_landmark_type <span class="op">=</span> <span class="st">"state"</span>,</span>
<span>  w_max <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  w_stabilised <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  w_max_follow <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  pv_group_vars <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  pv_n_pctls <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  pv_precalc <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  pv_ids <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  CI <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  CI_type <span class="op">=</span> <span class="st">"bootstrap"</span>,</span>
<span>  CI_R_boot <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  CI_seed <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  transitions_out <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  assess_moderate <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  assess_mean <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-data-ms">data_ms<a class="anchor" aria-label="anchor" href="#arg-data-ms"></a></dt>
<dd><p>Validation data in <code>msdata</code> format</p></dd>


<dt id="arg-data-raw">data_raw<a class="anchor" aria-label="anchor" href="#arg-data-raw"></a></dt>
<dd><p>Validation data in <code>data.frame</code> (one row per individual)</p></dd>


<dt id="arg-j">j<a class="anchor" aria-label="anchor" href="#arg-j"></a></dt>
<dd><p>Landmark state at which predictions were made</p></dd>


<dt id="arg-s">s<a class="anchor" aria-label="anchor" href="#arg-s"></a></dt>
<dd><p>Landmark time at which predictions were made</p></dd>


<dt id="arg-t">t<a class="anchor" aria-label="anchor" href="#arg-t"></a></dt>
<dd><p>Follow up time at which calibration is to be assessed</p></dd>


<dt id="arg-tp-pred">tp_pred<a class="anchor" aria-label="anchor" href="#arg-tp-pred"></a></dt>
<dd><p>Data frame or matrix of predicted transition probabilities at time t, if in state j at time s. There must be a separate column for the predicted transition probabilities into every state, even if these predicted transition probabilities are 0.</p></dd>


<dt id="arg-tp-pred-plot">tp_pred_plot<a class="anchor" aria-label="anchor" href="#arg-tp-pred-plot"></a></dt>
<dd><p>Data frame or matrix of predicted risks for each possible transition over which to plot the calibration curves. Argument provided to enable user to apply bootstrapping manually.</p></dd>


<dt id="arg-calib-type">calib_type<a class="anchor" aria-label="anchor" href="#arg-calib-type"></a></dt>
<dd><p>Whether calibration plots are estimated using BLR-IPCW ('blr'), MLR-IPCW ('mlr') or pseudo-values ('pv')</p></dd>


<dt id="arg-curve-type">curve_type<a class="anchor" aria-label="anchor" href="#arg-curve-type"></a></dt>
<dd><p>Whether calibration curves are estimated using restricted cubic splines ('rcs') or loess smoothers ('loess')</p></dd>


<dt id="arg-rcs-nk">rcs_nk<a class="anchor" aria-label="anchor" href="#arg-rcs-nk"></a></dt>
<dd><p>Number of knots when curves are estimated using restricted cubic splines</p></dd>


<dt id="arg-loess-span">loess_span<a class="anchor" aria-label="anchor" href="#arg-loess-span"></a></dt>
<dd><p>Span when curves are estimated using loess smoothers</p></dd>


<dt id="arg-loess-degree">loess_degree<a class="anchor" aria-label="anchor" href="#arg-loess-degree"></a></dt>
<dd><p>Degree when curves are estimated_ using loess smoothers</p></dd>


<dt id="arg-loess-surface">loess_surface<a class="anchor" aria-label="anchor" href="#arg-loess-surface"></a></dt>
<dd><p>see <code><a href="https://rdrr.io/r/stats/loess.control.html" class="external-link">loess.control</a></code></p></dd>


<dt id="arg-loess-statistics">loess_statistics<a class="anchor" aria-label="anchor" href="#arg-loess-statistics"></a></dt>
<dd><p>see <code><a href="https://rdrr.io/r/stats/loess.control.html" class="external-link">loess.control</a></code></p></dd>


<dt id="arg-loess-trace-hat">loess_trace_hat<a class="anchor" aria-label="anchor" href="#arg-loess-trace-hat"></a></dt>
<dd><p>see <code><a href="https://rdrr.io/r/stats/loess.control.html" class="external-link">loess.control</a></code></p></dd>


<dt id="arg-loess-cell">loess_cell<a class="anchor" aria-label="anchor" href="#arg-loess-cell"></a></dt>
<dd><p>see <code><a href="https://rdrr.io/r/stats/loess.control.html" class="external-link">loess.control</a></code></p></dd>


<dt id="arg-loess-iterations">loess_iterations<a class="anchor" aria-label="anchor" href="#arg-loess-iterations"></a></dt>
<dd><p>see <code><a href="https://rdrr.io/r/stats/loess.control.html" class="external-link">loess.control</a></code></p></dd>


<dt id="arg-loess-itertrace">loess_iterTrace<a class="anchor" aria-label="anchor" href="#arg-loess-itertrace"></a></dt>
<dd><p>see <code><a href="https://rdrr.io/r/stats/loess.control.html" class="external-link">loess.control</a></code></p></dd>


<dt id="arg-mlr-smoother-type">mlr_smoother_type<a class="anchor" aria-label="anchor" href="#arg-mlr-smoother-type"></a></dt>
<dd><p>Type of smoothing applied. Takes values <code>s</code> (see <code><a href="https://rdrr.io/pkg/VGAM/man/s.html" class="external-link">s</a></code>), <code>sm.ps</code> (see <code><a href="https://rdrr.io/pkg/VGAM/man/sm.ps.html" class="external-link">sm.ps</a></code>) or <code>sm.os</code> (see <code><a href="https://rdrr.io/pkg/VGAM/man/sm.os.html" class="external-link">sm.os</a></code>).</p></dd>


<dt id="arg-mlr-ps-int">mlr_ps_int<a class="anchor" aria-label="anchor" href="#arg-mlr-ps-int"></a></dt>
<dd><p>the number of equally-spaced B spline intervals in the vector spline smoother (see <code><a href="https://rdrr.io/pkg/VGAM/man/sm.ps.html" class="external-link">sm.ps</a></code>)</p></dd>


<dt id="arg-mlr-degree">mlr_degree<a class="anchor" aria-label="anchor" href="#arg-mlr-degree"></a></dt>
<dd><p>the degree of B-spline basis in the vector spline smoother (see <code><a href="https://rdrr.io/pkg/VGAM/man/sm.ps.html" class="external-link">sm.ps</a></code>)</p></dd>


<dt id="arg-mlr-s-df">mlr_s_df<a class="anchor" aria-label="anchor" href="#arg-mlr-s-df"></a></dt>
<dd><p>degrees of freedom of vector spline (see <code><a href="https://rdrr.io/pkg/VGAM/man/s.html" class="external-link">s</a></code>)</p></dd>


<dt id="arg-mlr-niknots">mlr_niknots<a class="anchor" aria-label="anchor" href="#arg-mlr-niknots"></a></dt>
<dd><p>number of interior knots (see <code><a href="https://rdrr.io/pkg/VGAM/man/sm.os.html" class="external-link">sm.os</a></code>)</p></dd>


<dt id="arg-weights">weights<a class="anchor" aria-label="anchor" href="#arg-weights"></a></dt>
<dd><p>Vector of inverse probability of censoring weights</p></dd>


<dt id="arg-w-function">w_function<a class="anchor" aria-label="anchor" href="#arg-w-function"></a></dt>
<dd><p>Custom function for estimating the inverse probability of censoring weights</p></dd>


<dt id="arg-w-covs">w_covs<a class="anchor" aria-label="anchor" href="#arg-w-covs"></a></dt>
<dd><p>Character vector of variable names to adjust for when calculating inverse probability of censoring weights</p></dd>


<dt id="arg-w-landmark-type">w_landmark_type<a class="anchor" aria-label="anchor" href="#arg-w-landmark-type"></a></dt>
<dd><p>Whether weights are estimated in all individuals uncensored at time s ('all') or only in individuals uncensored and in state j at time s ('state')</p></dd>


<dt id="arg-w-max">w_max<a class="anchor" aria-label="anchor" href="#arg-w-max"></a></dt>
<dd><p>Maximum bound for inverse probability of censoring weights</p></dd>


<dt id="arg-w-stabilised">w_stabilised<a class="anchor" aria-label="anchor" href="#arg-w-stabilised"></a></dt>
<dd><p>Indicates whether inverse probability of censoring weights should be stabilised or not</p></dd>


<dt id="arg-w-max-follow">w_max_follow<a class="anchor" aria-label="anchor" href="#arg-w-max-follow"></a></dt>
<dd><p>Maximum follow up for model calculating inverse probability of censoring weights. Reducing this to <code>t</code> + 1 may aid in the proportional hazards assumption being met in this model.</p></dd>


<dt id="arg-pv-group-vars">pv_group_vars<a class="anchor" aria-label="anchor" href="#arg-pv-group-vars"></a></dt>
<dd><p>Variables to group by before calculating pseudo-values</p></dd>


<dt id="arg-pv-n-pctls">pv_n_pctls<a class="anchor" aria-label="anchor" href="#arg-pv-n-pctls"></a></dt>
<dd><p>Number of percentiles of predicted risk to group by before calculating pseudo-values</p></dd>


<dt id="arg-pv-precalc">pv_precalc<a class="anchor" aria-label="anchor" href="#arg-pv-precalc"></a></dt>
<dd><p>Pre-calculated pseudo-values</p></dd>


<dt id="arg-pv-ids">pv_ids<a class="anchor" aria-label="anchor" href="#arg-pv-ids"></a></dt>
<dd><p>Id's of individuals to calculate pseudo-values for</p></dd>


<dt id="arg-ci">CI<a class="anchor" aria-label="anchor" href="#arg-ci"></a></dt>
<dd><p>Size of confidence intervals as a %</p></dd>


<dt id="arg-ci-type">CI_type<a class="anchor" aria-label="anchor" href="#arg-ci-type"></a></dt>
<dd><p>Method for estimating confidence interval (currently restricted to <code>bootstrap</code>)</p></dd>


<dt id="arg-ci-r-boot">CI_R_boot<a class="anchor" aria-label="anchor" href="#arg-ci-r-boot"></a></dt>
<dd><p>Number of bootstrap replicates when estimating the confidence interval for the calibration curve</p></dd>


<dt id="arg-ci-seed">CI_seed<a class="anchor" aria-label="anchor" href="#arg-ci-seed"></a></dt>
<dd><p>Seed for bootstrapping procedure</p></dd>


<dt id="arg-transitions-out">transitions_out<a class="anchor" aria-label="anchor" href="#arg-transitions-out"></a></dt>
<dd><p>Transitions for which to calculate calibration curves. Will do all possible transitions if left as NULL.</p></dd>


<dt id="arg-assess-moderate">assess_moderate<a class="anchor" aria-label="anchor" href="#arg-assess-moderate"></a></dt>
<dd><p>TRUE/FALSE whether to estimate data for calibration plots</p></dd>


<dt id="arg-assess-mean">assess_mean<a class="anchor" aria-label="anchor" href="#arg-assess-mean"></a></dt>
<dd><p>TRUE/FALSE whether to estimate mean calibration</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Extra arguments to be passed to w_function (custom function for estimating weights)</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p><code>calib_msm</code> returns a list containing two elements:
<code>plotdata</code> and <code>metadata</code>. The <code>plotdata</code> element contains the
data for the calibration plots. This will itself be a list with each element
containing calibration plot data for the transition probabilities into each of the possible
states. Each list element contains patient ids (<code>id</code>) from <code>data_raw</code>, the predicted
transition probabilities (<code>pred</code>) and the estimated observed event
probabilities (<code>obs</code>). If a confidence interval is requested, upper (<code>obs_upper</code>)
and lower (<code>obs_lower</code>) bounds for the observed event probabilities are also returned.
If tp_pred_plot is specified, column (<code>id</code>) is not returned.
The <code>metadata</code> element contains metadata including: a vector of the possible transitions,
a vector of which transitions calibration curves have been estimated for, the
size of the confidence interval, the method for estimating the calibration curve
and other user specified information.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>Observed event probabilities at time <code>t</code> are estimated for predicted
transition probabilities <code>tp_pred</code> out of state <code>j</code> at time <code>s</code>.</p>
<p><code>calib_type = 'blr'</code> estimates calibration curves using techniques for assessing
the calibration of a binary logistic regression model (Van Calster et al., 2016).
A choice between restricted cubic splines and loess smoothers for estimating the
calibration curve can be made using <code>curve_type</code>. Landmarking (van Houwelingen HC, 2007)
is applied to only assess calibration in individuals who are uncensored and in state <code>j</code> at time <code>s</code>.
Calibration can only be assessed in individuals who are also uncensored at time <code>t</code>,
which is accounted for using inverse probability of censoring weights (Hernan M, Robins J, 2020).
See method BLR-IPCW from Pate et al., (2024) for a full explanation of the approach.</p>
<p><code>calib_type = 'mlr'</code> estimates calibration scatter plots using a technique for assessing
the calibration of multinomial logistic regression models, namely the nominal
calibration framework of van Hoorde et al. (2014, 2015). Landmarking (van Houwelingen HC, 2007)
is applied to only assess calibration in individuals who are uncensored
and in state <code>j</code> at time <code>s</code>. Calibration can only be assessed in individuals
who are also uncensored at time <code>t</code>, which is accounted for using inverse probability
of censoring weights (Hernan M, Robins J, 2020). See method BLR-IPCW from Pate et al., (2024)
for a full explanation of the approach.</p>
<p><code>calib_type = 'pv'</code> estimates calibration curves using using pseudo-values (Andersen PK, Pohar Perme M, 2010)
calculated using the Aalen-Johansen estimator (Aalen OO, Johansen S, 1978).
Calibration curves are generated by regressing the pseudo-values on the predicted transition probabilities.
A choice between restricted cubic splines and loess smoothers for estimating the
calibration curve can be made using <code>curve_type</code>. Landmarking (van Houwelingen HC, 2007)
is applied to only assess calibration in individuals who are uncensored and in state <code>j</code> at time <code>s</code>.
The nature of pseudo-values means calibration can be assessed in all landmarked individuals,
regardless of their censoring time. See method Pseudo-value approach from Pate et al., (2024)
for a full explanation of the approach.</p>
<p>Two datasets for the same cohort of inidividuals must be provided. Firstly, <code>data_raw</code>
must be a <code>data.frame</code> with one row per individual containing the variables for
the time until censoring (<code>dtcens</code>), and an indicator for censoring <code>dtcens_s</code>,
where (<code>dtcens_s = 1</code>) if an individual is censored at time <code>dtcens</code>, and <code>dtcens_s = 0</code>
otherwise. When an individual enters an absorbing state, this prevents censoring
from happening (i.e. dtcens_s = 0). <code>data_raw</code> must also contain the desired variables
for estimating the weights. Secondly, <code>data_ms</code> must be a dataset of class <code>msdata</code>,
generated using the <code>[mstate]</code> package. This dataset is used to apply the landmarking
and identify which state individuals are in at time <code>t</code>. While <code>data_ms</code> can be
derived from <code>data_raw</code>, it would be inefficient to do this within <code>calibmsm::calib_msm</code>
due to the bootstrapping procedure, and therefore they must be inputted seperately.</p>
<p>Unless the user specifies the weights using <code>weights</code>, the weights are
estimated using a cox-proportional hazard model, assuming a linear
functional form of the variables defined in <code>w_covs</code>. We urge users to
specify their own model for estimating the weights. The <code>weights</code> argument
must be a vector with length equal to the number of rows of <code>data_raw</code>.</p>
<p>Confidence intervals cannot be produced for the calibration scatter plots (<code>calib_type = 'mlr'</code>).
For calibration curves estimated using <code>calib_type = 'blr'</code>, confidence intervals
can only be estimated using bootstrapping (<code>CI_type = 'bootstrap</code>). This procedure uses the internal method for
estimating weights, we therefore encourage users to specify their own bootstrapping
procedure, which incorporates their own model for estimating the weights. Details
on how to do this are provided in the vignette <em>BLR-IPCW-manual-bootstrap</em>.
For calibration curves estimated using <code>calib_type = 'pv'</code>, confidence intervals
can be estimated using bootstrapping (<code>CI_type = 'bootstrap</code>) or parametric formulae (<code>CI_type = 'parametric</code>).
For computational reasons we recommend using the parametric approach.</p>
<p>The calibration plots can be plotted using <code><a href="plot.calib_msm.html">plot.calib_msm</a></code> and <code><a href="plot.calib_mlr.html">plot.calib_mlr</a></code>.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Aalen OO, Johansen S. An Empirical Transition Matrix for Non-Homogeneous Markov Chains Based on Censored Observations.
<em>Scand J Stat</em>. 1978;5(3):141-150.</p>
<p>Andersen PK, Pohar Perme M. Pseudo-observations in survival analysis.
<em>Stat Methods Med Res</em>. 2010;19(1):71-99. doi:10.1177/0962280209105020</p>
<p>Hernan M, Robins J (2020). “12.2 Estimating IP weights via modeling.” In <em>Causal Inference:
What If</em>, chapter 12.2. Chapman Hall/CRC, Boca Raton.</p>
<p>Pate, A., Sperrin, M., Riley, R. D., Peek, N., Van Staa, T., Sergeant, J. C., Mamas, M. A.,
Lip, G. Y. H., Flaherty, M. O., Barrowman, M., Buchan, I., &amp; Martin, G. P.
Calibration plots for multistate risk predictions models.
<em>Statistics in Medicine</em>. 2024;April:1–23. doi: 10.1002/sim.10094.</p>
<p>Van Calster B, Nieboer D, Vergouwe Y, De Cock B, Pencina MJ, Steyerberg EW (2016). “A
calibration hierarchy for risk models was defined: From utopia to empirical data.” <em>Journal
of Clinical Epidemiology</em>, 74, 167–176. ISSN 18785921. doi:10.1016/j.jclinepi.2015.
12.005. URL http://dx.doi.org/10.1016/j.jclinepi.2015.12.005</p>
<p>Van Hoorde K, Vergouwe Y, Timmerman D, Van Huffel S, Steyerberg W, Van Calster B
(2014). “Assessing calibration of multinomial risk prediction models.” <em>Statistics in Medicine</em>,
33(15), 2585–2596. doi:10.1002/sim.6114.</p>
<p>Van Hoorde K, Van Huffel S, Timmerman D, Bourne T, Van Calster B (2015).
“A spline-based tool to assess and visualize the calibration of multiclass risk predictions.”
<em>Journal of Biomedical Informatics</em>, 54, 283–293. ISSN 15320464. doi:10.1016/j.jbi.2014.12.016.
URL http://dx.doi.org/10.1016/j.jbi.2014.12.016.</p>
<p>van Houwelingen HC (2007). “Dynamic Prediction by Landmarking in Event History Analysis.”
<em>Scandinavian Journal of Statistics</em>, 34(1), 70–85.</p>
<p>Yee TW (2015). <em>Vector Generalized Linear and Additive Models</em>. 1 edition.
Springer New, NY. ISBN 978-1-4939-4198-8. doi:10.1007/978-1-4939-2818-7.
URL https://link.springer.com/book/10.1007/978-1-4939-2818-7.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># Estimate BLR-IPCW calibration curves for the predicted transition</span></span></span>
<span class="r-in"><span><span class="co"># probabilities at time t = 1826, when predictions were made at time</span></span></span>
<span class="r-in"><span><span class="co"># s = 0 in state j = 1. These predicted transition probabilities are stored in tps0.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Extract the predicted transition probabilities out of state j = 1</span></span></span>
<span class="r-in"><span><span class="va">tp_pred</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">tps0</span>, <span class="va">j</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span>, <span class="fu">any_of</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"pstate"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">6</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Now estimate the observed event probabilities for each possible transition.</span></span></span>
<span class="r-in"><span><span class="va">dat_calib</span> <span class="op">&lt;-</span></span></span>
<span class="r-in"><span><span class="fu">calib_msm</span><span class="op">(</span>data_ms <span class="op">=</span> <span class="va">msebmtcal</span>,</span></span>
<span class="r-in"><span> data_raw <span class="op">=</span> <span class="va">ebmtcal</span>,</span></span>
<span class="r-in"><span> j<span class="op">=</span><span class="fl">1</span>,</span></span>
<span class="r-in"><span> s<span class="op">=</span><span class="fl">0</span>,</span></span>
<span class="r-in"><span> t <span class="op">=</span> <span class="fl">1826</span>,</span></span>
<span class="r-in"><span> tp_pred <span class="op">=</span> <span class="va">tp_pred</span>,</span></span>
<span class="r-in"><span> w_covs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"year"</span>, <span class="st">"agecl"</span>, <span class="st">"proph"</span>, <span class="st">"match"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Summarise the output</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">dat_calib</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> The method used to assess calibration was BLR-IPCW</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> There were non-zero predicted transition probabilities into states  1,2,3,4,5,6</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Calibration curves have been estimated for transitions into states  1,2,3,4,5,6</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Calibration was assessed at time 1826 and calibration was assessed in a landmarked cohort of individuals in state j = 1 at time s = 0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> A confidence interval was not estimated</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> The estimated data for calibration plots are stored in list element `plotdata`:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $state1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   id      pred       obs</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2  2 0.1140189 0.1095897</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4  4 0.1383878 0.1036308</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $state2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   id      pred       obs</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2  2 0.2316569 0.1698031</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4  4 0.1836189 0.1855591</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $state3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   id       pred       obs</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2  2 0.08442692 0.1248583</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4  4 0.07579429 0.1166606</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $state4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   id      pred       obs</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2  2 0.2328398 0.2427580</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4  4 0.2179331 0.2243106</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $state5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   id      pred       obs</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2  2 0.1481977 0.1909795</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4  4 0.1538475 0.1654523</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $state6</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   id      pred       obs</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2  2 0.1888598 0.2069354</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4  4 0.2304185 0.2542212</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> The estimated mean calibration are stored in list element `mean`:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        state1        state2        state3        state4        state5 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> -0.0216273416 -0.0152282576  0.0254839288  0.0097158314 -0.0003011927 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        state6 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  0.0032309988 </span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Alexander Pate, Glen P Martin.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

